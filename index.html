<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Themed Alola Pokémon Selector (Data Separated)</title>
    <style>
        /* ... (Your existing CSS is unchanged) ... */
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f4f4f4;
            color: #333;
        }
        .main-view, .list-view {
            max-width: 850px;
            margin: 0 auto;
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        .list-view {
            display: none;
        }
        h1 {
            color: #1a73e8;
            text-align: center;
        }
        .controls-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #e9e9e9;
        }
        .control-group label, .control-group select {
            display: block;
            width: 100%;
            margin-bottom: 5px;
        }
        .control-group select {
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #ccc;
        }
        .legendary-controls {
            grid-column: 1 / 4;
            display: flex;
            justify-content: space-around;
            padding-top: 10px;
            border-top: 1px dashed #ccc;
        }
        button {
            display: block;
            width: 100%;
            padding: 12px 20px;
            font-size: 18px;
            cursor: pointer;
            background-color: #1a73e8;
            color: white;
            border: none;
            border-radius: 5px;
            transition: background-color 0.3s;
            margin-top: 10px;
        }
        button:hover {
            background-color: #155bb5;
        }
        #result-box {
            min-height: 180px;
            margin-top: 20px;
            padding: 20px;
            border: 2px solid #ffde00;
            border-radius: 8px;
            background-color: #fff; 
            text-align: center;
            transition: background-color 0.3s, border-color 0.3s;
        }
        .shiny-background {
            background-color: #ffe066 !important; 
            border-color: #cc9900 !important;
        }
        #pokemon-name {
            font-size: 2.2em;
            font-weight: bold;
            color: #cc0000;
            text-shadow: 1px 1px 1px #888;
            margin-bottom: 15px;
        }
        .shiny-label {
            color: #1a73e8;
            font-size: 0.7em;
            margin-left: 10px;
        }
        #pokemon-category-info {
            font-style: italic;
            color: #555;
            margin-bottom: 10px;
            text-transform: capitalize;
        }
        .stats-table {
            width: 100%;
            margin-bottom: 15px;
            border-collapse: collapse;
            font-size: 0.9em;
        }
        .stats-table td {
            text-align: center;
            padding: 4px 0;
            border: 1px solid #eee;
        }
        .stats-table tr:first-child td {
            font-weight: bold;
            background-color: #f0f0f0;
        }
        .move-table {
            width: 100%;
            margin: 15px auto;
            border-collapse: collapse;
        }
        .move-table th, .move-table td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: left;
            font-size: 0.9em;
        }
        .move-table th {
            background-color: #eee;
        }
        .list-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .pokemon-card {
            border: 1px solid #ddd;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 5px;
            background-color: #f9f9f9;
        }
        .card-name {
            font-size: 1.5em;
            color: #1a73e8;
            margin-bottom: 5px;
        }
        .card-details {
            font-size: 0.9em;
            color: #555;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>

<div class="main-view" id="main-view">
    <h1>Themed Alola Pokémon Selector ☀️</h1>
    <p style="text-align: center; color: green;" id="load-status">Loading Pokémon Data...</p>

    <div class="controls-grid">
        <div class="control-group">
            <label for="occasion-select">Occasion/Habitat:</label>
            <select id="occasion-select">
                <option value="all">All Habitats</option>
                <option value="jungle">Jungle / Forest</option>
                <option value="desert">Desert / Mountain</option>
                <option value="plains">Plains / Route</option>
                <option value="city">City / Urban</option>
                <option value="cave">Cave / Underworld</option>
                <option value="water">Water / Beach</option>
            </select>
        </div>
        <div class="control-group">
            <label for="type-select">Pokémon Type:</label>
            <select id="type-select">
                <option value="all">All Types</option>
                <option value="normal">Normal</option>
                <option value="fire">Fire</option>
                <option value="water">Water</option>
                <option value="grass">Grass</option>
                <option value="electric">Electric</option>
                <option value="ice">Ice</option>
                <option value="fighting">Fighting</option>
                <option value="poison">Poison</option>
                <option value="ground">Ground</option>
                <option value="flying">Flying</option>
                <option value="psychic">Psychic</option>
                <option value="bug">Bug</option>
                <option value="rock">Rock</option>
                <option value="ghost">Ghost</option>
                <option value="dragon">Dragon</option>
                <option value="steel">Steel</option>
                <option value="dark">Dark</option>
                <option value="fairy">Fairy</option>
            </select>
        </div>
        <div class="control-group">
            <label for="evolution-select">Evolution Stage:</label>
            <select id="evolution-select">
                <option value="all">All Stages</option>
                <option value="lowest">Lowest Evolution</option>
                <option value="middle">Middle Evolution</option>
                <option value="highest">Highest Evolution</option>
            </select>
        </div>
        <div class="legendary-controls">
            <label>
                <input type="checkbox" id="include-legendary" checked>
                Include Legendary/Mythical
            </label>
            <label>
                <input type="checkbox" id="include-ultrabeast" checked>
                Include Ultra Beasts
            </label>
        </div>
    </div>

    <button onclick="getRandomPokemon()">Find Themed Pokémon!</button> 

    <div id="result-box">
        <p id="pokemon-name">Select your filters and go!</p>
        <p id="pokemon-category-info"></p>
        <div id="moves-list">
            </div>
    </div>
    
    <p style="text-align: center; font-size: 0.8em; margin-top: 15px; color: #777;">
        <span id="history-status">The selector will avoid recent repeats.</span>
    </p>

    <button onclick="toggleListView()">View Entire List</button>

</div>

<div class="list-view" id="list-view">
    <div class="list-header">
        <h1>Full Pokémon Roster</h1>
        <button onclick="toggleListView()" style="width: 150px;">Return to Selector</button>
    </div>
    <div id="full-list-content">
        </div>
</div>

<script>
    let pokemonData = [];
    const HISTORY_SIZE = 8; 
    const history = [];

    // --- Data Loading Function ---
    async function loadPokemonData() {
        try {
            const response = await fetch('pokemon_data.json');
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            pokemonData = await response.json();
            document.getElementById('load-status').textContent = `Pokémon Data Loaded! Total: ${pokemonData.length} entries.`;
            document.getElementById('load-status').style.color = 'darkgreen';
        } catch (e) {
            console.error('Failed to load Pokémon data:', e);
            document.getElementById('load-status').textContent = 'ERROR: Failed to load pokemon_data.json. Check file path.';
            document.getElementById('load-status').style.color = 'red';
        }
    }

    // Call the loading function when the page loads
    loadPokemonData();

    // --- Utility Functions (Same as before) ---

    function generateMoveTable(moves) {
        let html = '<h3>Known Moves</h3><table class="move-table"><thead><tr><th>Move</th><th>Power (DMG)</th><th>Accuracy (ACC)</th><th>Heal (HP)</th></tr></thead><tbody>';
        
        moves.forEach(move => {
            const [name, power, acc, health] = move;
            const powerDisplay = power > 0 ? power : 'N/A';
            const healthDisplay = health > 0 ? health + '%' : 'N/A';
            const accDisplay = acc !== 0 ? acc : '—';

            html += `<tr><td>${name}</td><td>${powerDisplay}</td><td>${accDisplay}</td><td>${healthDisplay}</td></tr>`;
        });

        html += '</tbody></table>';
        return html;
    }

    function generateStatsTable(stats) {
        if (!stats) return '';
        let html = '<h3>Base Stats</h3><table class="stats-table">';
        
        // Header Row
        html += '<tr><td>HP</td><td>ATK</td><td>DEF</td><td>SPA</td><td>SPD</td><td>SPE</td></tr>';
        
        // Data Row
        html += `<tr><td>${stats.hp}</td><td>${stats.atk}</td><td>${stats.def}</td><td>${stats.spa}</td><td>${stats.spd}</td><td>${stats.spe}</td></tr>`;
        
        html += '</table>';
        return html;
    }
    
    // --- Core Generator Function (Same as before) ---

    function getRandomPokemon() {
        if (pokemonData.length === 0) {
            alert('Pokémon data is not yet loaded or failed to load. Please wait or check the load status message.');
            return;
        }

        const occasionFilter = document.getElementById('occasion-select').value;
        const typeFilter = document.getElementById('type-select').value;
        const evolutionFilter = document.getElementById('evolution-select').value;
        const includeLegendary = document.getElementById('include-legendary').checked;
        const includeUltraBeast = document.getElementById('include-ultrabeast').checked;
        const resultBox = document.getElementById('result-box');
        
        // Shiny Roll (1 in 100)
        const isShiny = Math.floor(Math.random() * 100) === 0;

        const filteredList = pokemonData.filter(p => {
            const isLegendary = p.category === 'Legendary' || p.category === 'Mythical';
            const isUltraBeast = p.category === 'Ultra Beast';
            
            if (isLegendary && !includeLegendary) return false;
            if (isUltraBeast && !includeUltraBeast) return false;

            // Apply habitat and evolution filters only to 'Standard' Pokémon
            const isStandardEvolutionLine = p.evolution === 'lowest' || p.evolution === 'middle' || p.evolution === 'highest';

            if ((p.category === 'Standard' || isStandardEvolutionLine) && (p.category !== 'Legendary' && p.category !== 'Ultra Beast')) {
                if (occasionFilter !== 'all' && p.habitat !== occasionFilter) return false;
                if (evolutionFilter !== 'all' && p.evolution !== evolutionFilter) return false;
            }
            
            if (typeFilter !== 'all' && !p.types.includes(typeFilter)) return false;

            return true;
        });

        let availablePokemon = filteredList.filter(p => !history.includes(p.name));

        const resultName = document.getElementById('pokemon-name');
        const movesListElement = document.getElementById('moves-list');
        const historyStatus = document.getElementById('history-status');
        const categoryInfo = document.getElementById('pokemon-category-info');

        if (filteredList.length === 0) {
            resultName.textContent = "No Pokémon available with current filters.";
            categoryInfo.textContent = "Try adjusting your filters!";
            movesListElement.innerHTML = '';
            historyStatus.textContent = "History tracking is paused.";
            resultBox.classList.remove('shiny-background');
            return;
        }

        if (availablePokemon.length === 0) {
            availablePokemon = filteredList;
            history.length = 0; 
            console.log("History reset to allow for a new selection.");
        }

        const randomIndex = Math.floor(Math.random() * availablePokemon.length);
        const selectedPokemon = availablePokemon[randomIndex];

        // Apply Shiny Styling
        if (isShiny) {
            resultName.innerHTML = `${selectedPokemon.name} <span class="shiny-label">(Shiny) ✨</span>`;
            resultBox.classList.add('shiny-background');
        } else {
            resultName.textContent = selectedPokemon.name;
            resultBox.classList.remove('shiny-background');
        }

        // Update display 
        categoryInfo.innerHTML = `Category: ${selectedPokemon.category} | Types: ${selectedPokemon.types.map(t => t.charAt(0).toUpperCase() + t.slice(1)).join(', ')} | Evolution Stage: ${selectedPokemon.evolution.charAt(0).toUpperCase() + selectedPokemon.evolution.slice(1)}`;
        
        // Combine Stats and Moves tables
        movesListElement.innerHTML = generateStatsTable(selectedPokemon.stats) + generateMoveTable(selectedPokemon.moves);

        // Update history
        history.push(selectedPokemon.name);
        if (history.length > HISTORY_SIZE) {
            history.shift(); 
        }
        
        historyStatus.textContent = `Last ${history.length} selections (No Repetition): ${history.join(', ')}`;
    }

    // --- Entire List View Logic ---

    function generateFullListContent() {
        if (pokemonData.length === 0) {
            document.getElementById('full-list-content').innerHTML = '<p>Pokémon data is not yet loaded.</p>';
            return;
        }

        const listContainer = document.getElementById('full-list-content');
        listContainer.innerHTML = ''; 

        const sortedData = [...pokemonData].sort((a, b) => a.name.localeCompare(b.name));

        sortedData.forEach(p => {
            const card = document.createElement('div');
            card.className = 'pokemon-card';
            
            const nameEl = document.createElement('div');
            nameEl.className = 'card-name';
            nameEl.textContent = p.name;
            
            const detailsEl = document.createElement('div');
            detailsEl.className = 'card-details';
            detailsEl.innerHTML = `
                Category: ${p.category} | 
                Evolution: ${p.evolution.charAt(0).toUpperCase() + p.evolution.slice(1)} | 
                Types: ${p.types.map(t => t.charAt(0).toUpperCase() + t.slice(1)).join(', ')} |
                Habitat: ${p.habitat.charAt(0).toUpperCase() + p.habitat.slice(1)}
            `;

            card.appendChild(nameEl);
            card.appendChild(detailsEl);
            card.innerHTML += generateStatsTable(p.stats);
            card.innerHTML += generateMoveTable(p.moves);
            
            listContainer.appendChild(card);
        });
    }

    function toggleListView() {
        const mainView = document.getElementById('main-view');
        const listView = document.getElementById('list-view');

        if (mainView.style.display !== 'none') {
            generateFullListContent(); 
            mainView.style.display = 'none';
            listView.style.display = 'block';
        } else {
            listView.style.display = 'none';
            mainView.style.display = 'block';
        }
    }
</script>
</body>
</html>
