<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alolan Walking Simulator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }

        /* Custom Keyframes for the Walking Animation */
        @keyframes walk-cycle {
          0% { transform: translateX(-45%) scaleX(1); }
          49% { transform: translateX(45%) scaleX(1); }
          50% { transform: translateX(45%) scaleX(-1); } /* Turn around */
          99% { transform: translateX(-45%) scaleX(-1); }
          100% { transform: translateX(-45%) scaleX(1); } /* Flip back for seamless loop start */
        }
        .animate-walk {
          animation: walk-cycle 8s linear infinite;
        }

        .player-walker {
            /* üèÉ emoji size */
            font-size: 32px; 
            line-height: 1;
            position: absolute;
            bottom: 5px;
            left: 50%;
            /* Initial centering */
            transform: translateX(-50%);
        }
        
        /* Biome Transition Effect */
        .biome-background {
          transition: background-color 1.5s ease-in-out;
        }

        /* Pokecenter Icon Animation */
        .pokecenter-fade {
            transition: opacity 2s ease-in-out, transform 2s ease-in-out;
        }
    </style>
</head>
<body class="bg-gray-100 p-4 min-h-screen">

    <div class="max-w-4xl mx-auto">
        <header class="text-center mb-6">
            <a href="index.html" class="text-indigo-600 hover:text-indigo-800 text-sm font-semibold inline-flex items-center mb-3">
                <i class="fas fa-arrow-left mr-2"></i> Back to Randomizer
            </a>
            <h1 class="text-4xl font-extrabold text-gray-900">
                <span class="text-indigo-600">Alolan</span> Walking Simulator üèùÔ∏è
            </h1>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            
            <!-- --- Main Simulator Display (Col 1 & 2) --- -->
            <div class="lg:col-span-2 bg-white rounded-xl shadow-2xl overflow-hidden p-6 border-4 border-gray-200">
                
                <!-- Status Header -->
                <div class="flex justify-between items-center mb-4 pb-2 border-b border-gray-200">
                    <div class="flex items-center">
                        <span class="text-lg font-bold text-gray-700 mr-4">STATUS:</span>
                        <div id="status-display" class="font-semibold text-green-500">RUNNING</div>
                    </div>
                    <div class="text-sm font-medium text-gray-500 flex items-center">
                        <i id="biome-icon" class="fas fa-tree mr-2"></i>
                        Biome: <span id="biome-name" class="ml-1 font-bold">Lush Jungle</span>
                    </div>
                </div>

                <!-- Biome Display Area -->
                <div id="biome-container" class="relative h-64 rounded-xl shadow-inner biome-background bg-green-700">
                    <!-- The "Ground" line -->
                    <div class="absolute bottom-0 left-0 w-full h-1 bg-black opacity-30"></div>

                    <!-- Walking Person Animation (CSS-based) -->
                    <div id="walker" class="player-walker animate-walk">
                        üèÉ
                    </div>

                    <!-- Pokecenter Icon -->
                    <div 
                        id="pokecenter-icon" 
                        class="pokecenter-fade absolute top-1/4 right-5 p-2 rounded-lg bg-red-100/90 shadow-lg border border-red-300 opacity-0 translate-x-10 pointer-events-none"
                    >
                        <div class="text-4xl text-center">
                            üè•
                        </div>
                        <p class="text-xs text-red-700 font-bold mt-1">Pok√©Center</p>
                    </div>
                </div>

                <!-- Biome Description -->
                <div class="mt-4 p-3 rounded-lg bg-gray-50 border-t border-gray-200">
                    <p id="biome-info" class="text-center text-md font-semibold text-gray-600">
                        You are currently walking through the Lush Jungle biome.
                    </p>
                </div>
            </div>

            <!-- --- Controls and Settings Area (Col 3) --- -->
            <div class="lg:col-span-1">
                <div class="bg-white p-6 rounded-xl shadow-2xl mb-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4 border-b pb-2">Controls</h2>
                    <div class="space-y-3">
                        <!-- Pause/Play Button -->
                        <button
                            id="play-pause-btn"
                            onclick="togglePlayPause()"
                            class="w-full py-3 rounded-xl font-bold text-lg transition duration-200 shadow-md transform hover:scale-[1.01] bg-yellow-500 hover:bg-yellow-600 text-white"
                        >
                            <span id="play-pause-text" class="flex items-center justify-center">
                                <i class="fas fa-pause mr-2"></i> Pause
                            </span>
                        </button>

                        <!-- Reset Button -->
                        <button
                            onclick="handleReset()"
                            class="w-full py-3 rounded-xl bg-indigo-600 hover:bg-indigo-700 text-white font-bold text-lg transition duration-200 shadow-md transform hover:scale-[1.01]"
                        >
                            <span class="flex items-center justify-center"><i class="fas fa-redo-alt mr-2"></i> Reset Simulator</span>
                        </button>

                        <!-- Settings Button -->
                        <button
                            onclick="toggleSettings()"
                            class="w-full py-3 rounded-xl font-bold text-lg transition duration-200 shadow-md transform hover:scale-[1.01] border-2 bg-gray-200 hover:bg-gray-300 text-gray-700 border-gray-300"
                        >
                            <span class="flex items-center justify-center"><i class="fas fa-cog mr-2"></i> Biome Settings</span>
                        </button>
                    </div>
                </div>

                <!-- Settings Pane Display -->
                <div id="settings-pane" class="hidden">
                    <!-- Content populated by JS: updateSettingsPane() -->
                </div>
            </div>
        </div>

        <!-- --- Encounter Modal --- -->
        <div id="encounter-modal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center p-4 z-50 backdrop-blur-sm">
            <!-- Content populated by JS: showEncounterModal() -->
        </div>

    </div>

    <script>
        let POKEMON_DATA = [];

fetch('pokemon_data.json')
  .then(res => res.json())
  .then(data => { POKEMON_DATA = data; });

        // --- Configuration Data ---
        const BIOMES = [
  { name: 'Lush Jungle', type: 'jungle', color: 'bg-green-700', icon: 'fas fa-tree', text: 'text-green-200', allowedTypes: ['grass', 'bug', 'fairy'] },
  { name: 'Sandy Beach', type: 'water', color: 'bg-blue-500', icon: 'fas fa-anchor', text: 'text-blue-100', allowedTypes: ['water', 'ice'] },
  { name: 'Volcano Park', type: 'desert', color: 'bg-red-800', icon: 'fas fa-fire', text: 'text-red-200', allowedTypes: ['fire', 'rock', 'ground'], noPokecenter: true },
  { name: 'Spooky Caves', type: 'cave', color: 'bg-gray-700', icon: 'fas fa-mountain', text: 'text-gray-200', allowedTypes: ['ghost', 'dark', 'dragon'], noPokecenter: true },
  { name: 'Hau\'oli City', type: 'city', color: 'bg-indigo-600', icon: 'fas fa-city', text: 'text-indigo-200', allowedTypes: ['normal', 'electric', 'steel', 'psychic'] },
];


        // --- Global State ---
        let status = 'paused'; // 'running', 'paused', 'encounter', 'settings'
        let currentBiome = BIOMES[0];
        let disabledBiomes = {};
        let encounterPokemon = null;
        let isPokecenterVisible = false;

        // --- Timer Refs ---
        let biomeTimer = null;
        let encounterTimer = null;
        let pokecenterTimer = null;
        let pokecenterVisibilityTimer = null;

        // --- Helper Functions ---
        const getRandomTime = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;
        
        const calculateNextBiomeTime = () => getRandomTime(100, 500) * 1000; // 100-500 seconds
        const calculateNextEncounterTime = () => getRandomTime(15, 30) * 1000; // 5-15 seconds
        const calculateNextPokecenterTime = () => getRandomTime(300, 900) * 1000; // 300-900 seconds
        
        // Mock function to simulate fetching detailed Pok√©mon stats
        const getPokemonDetails = (name) => {
            const baseStat = name.length * 10 + 50;
            return {
                name,
                hp: baseStat + 20,
                atk: baseStat + 5,
                def: baseStat - 10,
                spa: baseStat + 15,
                spd: baseStat - 5,
                spe: baseStat + 10,
                total: baseStat * 6 + 30,
            };
        };

        const clearAllTimers = () => {
            clearTimeout(biomeTimer);
            clearTimeout(encounterTimer);
            clearTimeout(pokecenterTimer);
            clearTimeout(pokecenterVisibilityTimer);
        };
        
        // --- DOM Update Functions ---

        const updateStatusDisplay = () => {
            const display = document.getElementById('status-display');
            const button = document.getElementById('play-pause-btn');
            const buttonText = document.getElementById('play-pause-text');
            const walker = document.getElementById('walker');
            
            // Clear all status styles
            display.classList.remove('text-green-500', 'text-yellow-500', 'text-red-500', 'text-blue-500');
            button.classList.remove('bg-yellow-500', 'hover:bg-yellow-600', 'bg-green-500', 'hover:bg-green-600', 'disabled:opacity-50');
            button.disabled = false;

            switch (status) {
                case 'running':
                    display.innerHTML = '<i class="fas fa-play mr-1"></i> RUNNING';
                    display.classList.add('text-green-500');
                    buttonText.innerHTML = '<i class="fas fa-pause mr-2"></i> Pause';
                    button.classList.add('bg-yellow-500', 'hover:bg-yellow-600');
                    walker.classList.add('animate-walk');
                    break;
                case 'paused':
                    display.innerHTML = '<i class="fas fa-pause mr-1"></i> PAUSED';
                    display.classList.add('text-yellow-500');
                    buttonText.innerHTML = '<i class="fas fa-play mr-2"></i> Start/Resume';
                    button.classList.add('bg-green-500', 'hover:bg-green-600');
                    walker.classList.remove('animate-walk');
                    break;
                case 'encounter':
                    display.innerHTML = '<i class="fas fa-times mr-1"></i> ENCOUNTER';
                    display.classList.add('text-red-500');
                    button.disabled = true; // Disable play/pause during encounter
                    button.classList.add('disabled:opacity-50', 'bg-yellow-500');
                    buttonText.innerHTML = '<i class="fas fa-pause mr-2"></i> Paused';
                    walker.classList.remove('animate-walk');
                    break;
                case 'settings':
                    display.innerHTML = '<i class="fas fa-cog mr-1"></i> CONFIG';
                    display.classList.add('text-blue-500');
                    buttonText.innerHTML = '<i class="fas fa-play mr-2"></i> Start/Resume';
                    button.classList.add('bg-green-500', 'hover:bg-green-600');
                    walker.classList.remove('animate-walk');
                    break;
            }
        };

        const updateBiomeDisplay = (biome) => {
            const container = document.getElementById('biome-container');
            const nameEl = document.getElementById('biome-name');
            const iconEl = document.getElementById('biome-icon');
            const infoEl = document.getElementById('biome-info');
            
            // 1. Update Container Background
            BIOMES.forEach(b => container.classList.remove(b.color));
            container.classList.add(biome.color);
            
            // 2. Update Text Info
            nameEl.textContent = biome.name;
            iconEl.className = `${biome.icon} mr-2`;
            
            // 3. Update description text
            infoEl.innerHTML = `<span class="text-xl mr-2 ${biome.text}"><i class="${biome.icon}"></i></span> You are currently walking through the ${biome.name} biome.`;
        };

        const updatePokecenterVisibility = (isVisible) => {
            const center = document.getElementById('pokecenter-icon');
            if (isVisible) {
                center.classList.remove('opacity-0', 'translate-x-10', 'pointer-events-none');
                center.classList.add('opacity-100', 'translate-x-0');
            } else {
                center.classList.add('opacity-0', 'translate-x-10', 'pointer-events-none');
                center.classList.remove('opacity-100', 'translate-x-0');
            }
            isPokecenterVisible = isVisible;
        }

        const showEncounterModal = (pokemon) => {
            const modal = document.getElementById('encounter-modal');
            const stats = [
                { label: 'HP', value: pokemon.hp, icon: 'fa-heart', color: 'text-red-600' },
                { label: 'Attack', value: pokemon.atk, icon: 'fa-sword', color: 'text-orange-600' },
                { label: 'Defense', value: pokemon.def, icon: 'fa-shield', color: 'text-blue-600' },
                { label: 'Special Atk', value: pokemon.spa, icon: 'fa-wand-magic-sparkles', color: 'text-purple-600' },
                { label: 'Special Def', value: pokemon.spd, icon: 'fa-shield-halved', color: 'text-green-600' },
                { label: 'Speed', value: pokemon.spe, icon: 'fa-bolt', color: 'text-yellow-600' },
            ];

            function showEncounterModal(pokemon) {
  const modal = document.getElementById('encounter-modal');

  const movesList = pokemon.moves.map(move => `
    <li class="py-1 px-2 bg-indigo-50 rounded-md mb-1 text-gray-700 font-medium">
      ${move}
    </li>
  `).join('');

  modal.innerHTML = `
    <div class="bg-white p-8 rounded-3xl shadow-2xl max-w-lg w-full border-4 border-yellow-400">
      <div class="text-center mb-6">
        <div class="text-6xl mb-2">‚ö°</div>
        <h2 class="text-4xl font-extrabold text-gray-900 mt-2">
          Wild <span class="text-indigo-600">${pokemon.name}</span> Appeared!
        </h2>
        <p class="text-xl text-gray-500 mt-1 font-medium">Simulation Paused</p>
      </div>

      <div class="bg-gray-50 p-6 rounded-2xl border border-gray-200">
        <h3 class="text-2xl font-bold mb-3 text-gray-700 flex items-center">
          <i class="fas fa-heart mr-2 text-red-500"></i> HP
        </h3>
        <p class="text-3xl font-extrabold text-red-600 text-center mb-4">${pokemon.hp}</p>

        <h3 class="text-2xl font-bold mb-3 text-gray-700 flex items-center">
          <i class="fas fa-fist-raised mr-2 text-indigo-500"></i> Moves
        </h3>
        <ul class="list-none">${movesList}</ul>
      </div>

      <button
        onclick="handleContinue()"
        class="w-full mt-6 py-4 px-4 bg-indigo-600 hover:bg-indigo-700 text-white text-xl font-bold rounded-xl shadow-lg transition duration-200 transform hover:scale-[1.02]"
      >
        Continue Journey
      </button>
    </div>
  `;
  modal.classList.remove('hidden');
}


        const hideEncounterModal = () => {
            document.getElementById('encounter-modal').classList.add('hidden');
            document.getElementById('encounter-modal').innerHTML = ''; // Clear content
        }

        const updateSettingsPane = () => {
            const pane = document.getElementById('settings-pane');
            pane.classList.remove('hidden');
            
            const biomeList = BIOMES.map(biome => `
                <label class="flex items-center p-3 rounded-xl cursor-pointer transition duration-150 border ${disabledBiomes[biome.name] ? 'bg-red-50 border-red-300 opacity-70' : 'bg-white border-green-300 shadow-sm hover:bg-green-50'}">
                    <input
                        type="checkbox"
                        onchange="toggleBiomeDisabled('${biome.name}')"
                        ${!disabledBiomes[biome.name] ? 'checked' : ''}
                        class="mr-2 h-5 w-5 text-indigo-600 border-gray-300 rounded-lg focus:ring-indigo-500"
                    />
                    <span class="text-gray-800 flex items-center text-sm font-medium">
                        <i class="${biome.icon} w-5 h-5 mr-2 text-indigo-500"></i>
                        <span class="ml-2">${biome.name}</span>
                        ${biome.noPokecenter ? '<span class="ml-2 px-2 py-0.5 text-xs bg-red-500 text-white rounded-full">No PC</span>' : ''}
                    </span>
                </label>
            `).join('');

            pane.innerHTML = `
                <div class="p-4 bg-white rounded-xl shadow-lg mt-4 w-full border border-gray-100">
                    <div class="flex justify-between items-center mb-3">
                        <h3 class="text-xl font-bold text-gray-800 flex items-center">
                            <i class="fas fa-cog w-5 h-5 mr-2"></i>
                            Simulation Settings
                        </h3>
                        <button 
                            onclick="toggleSettings()"
                            class="p-1 rounded-full text-gray-500 hover:bg-gray-200 transition"
                        >
                            <i class="fas fa-times w-5 h-5"></i>
                        </button>
                    </div>

                    <div class="p-4 bg-gray-50 rounded-lg shadow-inner">
                        <h4 class="text-lg font-semibold mb-2 text-gray-700 flex items-center">
                            <i class="fas fa-layer-group w-5 h-5 mr-2 text-indigo-500"></i>
                            Disable Biomes (Requires Reset)
                        </h4>
                        <div class="grid grid-cols-2 gap-3">
                            ${biomeList}
                        </div>
                        <p class="text-xs text-red-500 mt-3 font-medium text-center">
                            You must click the "Reset" button for biome changes to take effect.
                        </p>
                    </div>
                </div>
            `;
        }

        // --- Timer Handlers ---

function handleBiomeChange() {
  const availableBiomes = BIOMES.filter(
    biome => !disabledBiomes[biome.name] && biome.name !== currentBiome.name
  );

  if (availableBiomes.length === 0) {
    startTimers();
    return;
  }

  const newBiome = availableBiomes[Math.floor(Math.random() * availableBiomes.length)];

  currentBiome = newBiome;
  updateBiomeDisplay(currentBiome);

  setTimeout(startTimers, 1500);
}

const getRandomPokemonForBiome = (biome) => {
  // Filter Pok√©mon whose type matches biome allowedTypes
  const candidates = POKEMON_DATA.filter(p =>
    p.types.some(t => biome.allowedTypes.includes(t))
  );

  if (candidates.length === 0) return null;

  // Pick random Pok√©mon from candidates
  return candidates[Math.floor(Math.random() * candidates.length)];
};

function handlePokecenterAppearance() {
  // Check if the current biome forbids a Pokecenter
  if (currentBiome.noPokecenter) {
    // If forbidden, immediately reset the timer for the next check
    console.log(`Pok√©Center skipped in ${currentBiome.name}. Retrying timer.`);
    pokecenterTimer = setTimeout(handlePokecenterAppearance, calculateNextPokecenterTime());
    return;
  }

  // Show Pokecenter
  updatePokecenterVisibility(true);

  // Set a timer to make the Pokecenter disappear after 60 seconds
  pokecenterVisibilityTimer = setTimeout(() => {
    updatePokecenterVisibility(false);
  }, 60000);

  // Restart the pokecenter timer for the next appearance
  pokecenterTimer = setTimeout(handlePokecenterAppearance, calculateNextPokecenterTime());
}

// Spawn-by-type encounter (hoisted so timers can reference it safely)
function handleEncounter() {
  clearAllTimers();
  status = 'encounter';
  updateStatusDisplay();

  const pokemon = getRandomPokemonForBiome(currentBiome);
  if (!pokemon) {
    console.warn(`No Pok√©mon found for biome: ${currentBiome.name}`);
    startTimers();
    return;
  }

  // Build encounter object with HP and moves only
  encounterPokemon = {
    name: pokemon.name,
    hp: pokemon.stats.hp,
    moves: pokemon.moves.map(m => m[0]) // just the move names
  };

  showEncounterModal(encounterPokemon);
  updatePokecenterVisibility(false);
}


  showEncounterModal(encounterPokemon);
  updatePokecenterVisibility(false);
}

// --- Game Control Functions ---

const startTimers = () => {
  if (status === 'running') return;

  // Safety: ensure we never stack timers
  clearAllTimers();

  status = 'running';
  updateStatusDisplay();

  // Biome change
  biomeTimer = setTimeout(handleBiomeChange, calculateNextBiomeTime());

  // Encounter
  const encounterDelay = Number(calculateNextEncounterTime());
  if (Number.isFinite(encounterDelay)) {
    encounterTimer = setTimeout(handleEncounter, encounterDelay);
  } else {
    console.warn('Encounter timer skipped: invalid delay.');
  }

  // Pokecenter appearance
  pokecenterTimer = setTimeout(handlePokecenterAppearance, calculateNextPokecenterTime());
};

const pauseTimers = () => {
  clearAllTimers();
  if (status !== 'encounter') {
    status = 'paused';
    updateStatusDisplay();
  }
};

window.togglePlayPause = () => {
  if (status === 'running') {
    pauseTimers();
  } else if (status === 'paused' || status === 'settings') {
    if (status === 'settings') toggleSettings();
    startTimers();
  }
};

window.toggleSettings = () => {
  if (status === 'settings') {
    status = 'paused';
    document.getElementById('settings-pane').classList.add('hidden');
    updateStatusDisplay();
  } else {
    pauseTimers();
    status = 'settings';
    updateStatusDisplay();
    updateSettingsPane();
  }
};

window.toggleBiomeDisabled = (biomeName) => {
  disabledBiomes[biomeName] = !disabledBiomes[biomeName];
  updateSettingsPane();
};

window.handleContinue = () => {
  hideEncounterModal();
  encounterPokemon = null;
  startTimers();
};

window.handleReset = () => {
  clearAllTimers();

  const availableBiomes = BIOMES.filter(biome => !disabledBiomes[biome.name]);
  if (availableBiomes.length === 0) {
    currentBiome = BIOMES[0];
  } else {
    currentBiome = availableBiomes[Math.floor(Math.random() * availableBiomes.length)];
  }

  updateBiomeDisplay(currentBiome);
  hideEncounterModal();
  updatePokecenterVisibility(false);
  status = 'paused';

  setTimeout(startTimers, 50);
};

// --- Initialization ---
window.onload = function() {
  handleReset();
};


    </script>
</body>
</html>
